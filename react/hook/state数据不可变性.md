# state 数据不可变性

数据不可变性是指将数据视为只读的, 每次更新都保留其原始值不变, 使用全新的数据进行替换;

1. 直接修改 state 不会使组件重新渲染, 因为 react 使用浅对比. 对于基本类型, 对比先后两次的值是否相等, 如果不等则进行更新; 对于引用类型, 对比先后两次引用地址是否相等, 不等时才进行更新;
2. 嵌套的对象, 数据进行深度更新时, 需要从要更新的位置创建副本到顶层, 或者使用 Immer 库;

#### 为什么 react 不建议直接修改数据?

1. 方便调试数据, 如果使用 console.log 打印数据, 数据不会被直接修改的数据所影响;
2. 性能优化, react 使用浅比较, 即只比较引用地址(引用类型), 这样比递归比较全部性能更好;
3. 新特性支持;
4. 特殊需求, 一些应用程序功能，如实现撤消/重做、显示更改历史或允许用户将表单重置为初始值，在不直接修改数据的情况下更容易实现. 这是因为你可以将每次更新的数据保存在内存中，并在适当的时候重用它们。如果你直接修改数据，像这样的特性以后很难实现;
5. react 采用更简单的实现, 由于 react 不依赖于数据响应式(vue), 所以它不需要对数据做任何处理, 例如劫持属性做一些监听操作, 搜集依赖等;这就是为什么 state 可以储存任何对象数据, 不管它有多大多复杂, 都不会产生性能问题;
