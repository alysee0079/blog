# 前端性能优化

#### 资源合并与压缩

    html压缩:
      html压缩就是压缩这些在文本文件中有意义,但是在html中不显示的字符,包括空格,制表符,换行符等,还有一些其他意义的字符,如html注释也可以被压缩.
    如何进行html压缩:
      1.使用在线工具压缩
      2.nodejs提供了html-minifier工具(在构建层压缩)
      3.后端模板引擎渲染压缩
    css压缩:无效代码删除,css语义合并.
      如何进行css压缩:
      1.在线网站
      2.html-minifier
      3.使用clean-css
    js压缩与混乱: 无效字符删除,删除注释,代码语义的缩短和优化,代码保护.
      如何进行js压缩与混乱:
      1.使用在线工具
      2.html-minifier
      3.使用uglifyjs对js进行压缩
    文件合并
      1. 在线合并
      2. webpack, fis3
    图片压缩:
      不同格式图片常用的业务场景:
      jpg有损压缩，压缩率高，不支持透明
      png支持透明，浏览器兼容好
      webp压缩程度更好，在ios webview有兼容性问题
      svg矢量图，代码内嵌，相对较小，图片样式相对简单的场景
      CSS雪碧图:把你的网站上用到的一些图片整合到一张单独的图片中, 减少你的网站的HTTP请求数量.
      Image inline(base64): 将图片的内容内嵌到html当中, 减少你的网站的HTTP请求数量.
      矢量图: 使用SVG进行矢量图的绘制, 使用iconfont解决icon问题.
      在线压缩: tinypng

#### css,js 加载与执行

    css阻塞:
      1.css head中阻塞页面的渲染
      2.css阻塞js的执行
      3.css不阻塞外部脚本的加载
    js阻塞:
      1.直接引入的js阻塞页面的渲染
      2.js不阻塞资源的加载
      3.js顺序执行，阻塞后续js逻辑的执行
    异步加载js:
      1.动态加载
      2.defer:异步下载，在整个HTML解析完(DOMContentLoaded之前)才会执行，只针对外部脚本有效.
      3.async:异步下载，下载完成后立即执行,只针对外部脚本有效.
    图片懒加载:
      图片进入可视区域后再加载资源
    图片预加载(再使用之前加载):
      1.使用image标签加载图片
      2.使用image对象加载图片
      3.使用XMLHTTPReuqest加载图片
      4.preload.js

#### 浏览器重绘,回流

    回流:
      当render tree中的一部分(或全部)因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为回流(reflow)当页面布局和几何属性改变时就需要回流
    触发页面重布局的属性:
      盒子模型相关属性:
      width height padding margin display border-width border min-height
      定位属性及浮动:
      top bottom left right position float clear
      改变节点内部文字结构:
      text-align overflow-y font-weight overflow font-family line-height vertival-align white-space font-size
    重绘:
      当render tree中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如background-color。则就叫称为重绘
    触发重绘的属性:
      color border-style border-radius visibility text-decoration background background-image background-position background-repeat background-size outline-color outline outline-    style outline-width box-shadow

    回流必将引起重绘,而重绘不一定会引起回流

    避免重绘,回流的主要思想:
      1.避免使用导致重绘,回流的css属性
      2.将重绘,回流的影响范围限制在单独的图层内
      优化点:
      1. 用translate替代top改变
      2. 用opacity替代visibility
      3. 不要一条一条地修改 DOM 的样式，预先定义好 class，然后修改 DOM 的 className
      4. 把 DOM 离线后修改，比如：先把 DOM 给 display:none (有一次 Reflow)，然后你修改100次，然后再把它显示出来
      5. 不要把 DOM 结点的属性值放在一个循环里当成循环里的变量
      6. 不要使用 table 布局，可能很小的一个小改动会造成整个 table 的重新布局
      7. 动画实现的速度的选择
      8. 对于动画新建图层
      9. 启用 GPU 硬件加速

#### 浏览器储存

    Cookie:
      因为HTTP请求无状态，所以需要cookie去维持客户端状态
    cookie的生成方式
      1. http response header中的set-cookie
      2. js中可以通过document.cookie可以读写cookie
      仅仅作为浏览器存储（大小4KB左右，能力被localstorage替代）
      cookie中在相关域名下面 —— cdn的流量损耗
      httponly
    LocalStorage
      HTML5设计出来专门用于浏览器存储的
      大小为5M左右
      仅在客户端使用，不和服务端进行通信
      接口封装较好
      浏览器本地缓存方案
    SessionStorage
      会话级别的浏览器存储
      大小为5M左右
      仅在客户端使用，不和服务端进行通信
      接口封装较好
      对于表单信息的维护
    IndexedDB
      IndexedDB 是一种低级API，用于客户端存储大量结构化数据。该API使用索引来实现对该数据的高性能搜索。虽然 Web Storage 对于存储较少量的数据很有用，但对于存储更大量的结构化数据来     说，这种方法不太有用。IndexedDB提供了一个解决方案。为应用创建离线版本

    PWA
      PWA (Progressive Web Apps) 是一种 Web App 新模型，并不是具体指某一种前沿的技术或者某一个单一的知识点，我们从英文缩写来看就能看出来，这是一个渐进式的 Web App，是通过一系列新的    Web 特性，配合优秀的 UI 交互设计，逐步的增强 Web App 的用户体验。
      可靠：在没有网络的环境中也能提供基本的页面访问，而不会出现“未连接到互联网”的页面。
      快速：针对网页渲染及网络数据访问有较好优化。
      融入（Engaging）：应用可以被增加到手机桌面，并且和普通应用一样有全屏、推送等特性。
    Service Worker
      Service Worker 是一个脚本，浏览器独立于当前网页，将其在后台运行,为实现一些不依赖页面或者用户交互的特性打开了一扇大门。在未来这些特性将包括推送消息,背景后台同步，          geofencing（地理围栏定位），但它将推出的第一个首要特性，就是拦截和处理网络请求的能力，包括以编程方式来管理被缓存的响应。

#### 浏览器缓存

    强缓存:
      Cache-Control:
        max-age: 设置缓存最大时间,超过时间则请求网络,否则从缓存中获取资源,优先级高于Expires.
        s-max-age: 设置public(CDN)缓存最大时间,优先级高于max-age
        private: 私人缓存,客户端
        public: 公共缓存,CDN
        no-cache: 向浏览器发请求查询缓存是否过期
        no-store: 不进行缓存
      Expires(http1.0):
        缓存过期时间,用来指定资源到期的时间点,是服务器端的具体时间点.告诉浏览器在过期时间前浏览器可以直接从缓存取数据,而无需再次请求.优先级低于max-age.
    协商缓存
      Last-Modified/If-Modified-Since: 上次文件修改时间.
      Etag/If-None-Match: 文件内容hash值.

#### 服务端性能优化

    构建层模板编译
    数据无关的prerender的方式
    服务端渲染ssr

#### CDN 加速

#### DNS 预解析

作用：根据浏览器定义的规则，提前解析之后可能会用到的域名，使解析结果缓存到系统缓存中，缩短 DNS 解析时间，来提高网站的访问速度

1）是减少 DNS 的请求次数，2）是进行 DNS 预获取——DNS

```javascript
  1、打开和关闭DNS预解析
  <meta http-equiv="x-dns-prefetch-control" content="on">
  3、手动添加解析
  <link rel="dns-prefetch" href="//www.zhix.net">
```
